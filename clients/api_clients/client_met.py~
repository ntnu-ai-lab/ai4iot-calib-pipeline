import requests


class ClientMet():
    def __init__(self, client_id):
        self.client_id = client_id
        self.endpoint = 'https://frost.met.no/observations/v0.jsonld'

    def fetch_last_data(self, source, elements):

        # Define endpoint and parameters
        params = {
            'sources': source,
            'elements': ','.join(elements),
            'referencetime': 'latest',
            'timeresolutions': 'PT1H',
        }

        data = self._request(params)

        out_data = ()

        for x in data[0]['observations']:
            out_data = out_data + (x['value'],)

        return out_data

    def _request(self, params):
        # Issue an HTTP GET request
        r = requests.get(self.endpoint, params, auth=(self.client_id, ''))
        # Extract JSON data
        json = r.json()

        # Check if the request worked, print out any errors
        if r.status_code == 200:
            data = json['data']
            print('Data retrieved from frost.met.no!')
        else:
            print('Error! Returned status code %s' % r.status_code)
            print('Message: %s' % json['error']['message'])
            print('Reason: %s' % json['error']['reason'])

        return data
